import fetch from 'node-fetch';
function baseUrl(env){ return env === 'live' ? 'https://api-m.paypal.com' : 'https://api-m.sandbox.paypal.com'; }
export async function getAccessToken(env, clientId, clientSecret){ const base = baseUrl(env); const resp = await fetch(base + '/v1/oauth2/token', { method:'POST', headers:{ 'Authorization':'Basic '+Buffer.from(clientId+':'+clientSecret).toString('base64'), 'Content-Type':'application/x-www-form-urlencoded' }, body:'grant_type=client_credentials' }); if(!resp.ok) throw new Error('token failed'); const js = await resp.json(); return js.access_token; }
export async function createOrder(env, token, amount, currency='AUD'){ const base = baseUrl(env); const resp = await fetch(base + '/v2/checkout/orders', { method:'POST', headers:{ 'Authorization':'Bearer '+token, 'Content-Type':'application/json' }, body: JSON.stringify({ intent:'CAPTURE', purchase_units:[{ amount:{ currency_code: currency, value: Number(amount).toFixed(2) } }] }) }); return resp.json(); }
export async function captureOrder(env, token, orderId){ const base = baseUrl(env); const resp = await fetch(base + `/v2/checkout/orders/${encodeURIComponent(orderId)}/capture`, { method:'POST', headers:{ 'Authorization':'Bearer '+token, 'Content-Type':'application/json' } }); return resp.json(); }
